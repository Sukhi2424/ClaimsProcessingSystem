@model IEnumerable<ClaimsProcessingSystem.Models.Audit>

<div class="dropdown-menu dropdown-menu-end notification-dropdown" aria-labelledby="notificationDropdown">
    <h6 class="dropdown-header">Recent Activity</h6>
    <div class="list-group list-group-flush">
        @if (Model.Any())
        {
            @foreach (var notification in Model)
            {
                var isClaim = notification.TableName == "Claims";
                var isUser = notification.TableName == "AspNetUsers";
                var pkId = !string.IsNullOrEmpty(notification.PrimaryKey) ? System.Text.Json.JsonDocument.Parse(notification.PrimaryKey).RootElement.GetProperty("Id").ToString() : null;

                <a class="dropdown-item"
                   asp-controller="@(isClaim ? "Claims" : "Users")"
                   asp-action="@(isClaim ? "Details" : "Edit")"
                   asp-route-id="@pkId"
                   style="@(pkId == null ? "pointer-events: none;" : "")">

                    <div class="notification-icon">
                        @if (isClaim)
                        {
                            <i class="fas fa-file-invoice-dollar"></i>
                        }
                        else if (isUser)
                        {
                            <i class="fas fa-user-plus"></i>
                        }
                    </div>

                    <div class="notification-content">
                        <div class="notification-title">
                            @(isClaim ? "New Claim Added" : (isUser ? "New User Registered" : "New Activity"))
                        </div>
                        <div class="notification-time">
                            @notification.Timestamp.ToLocalTime().ToString("g")
                        </div>
                    </div>
                </a>
            }
        }
        else
        {
            <div class="dropdown-item text-muted">No new notifications.</div>
        }
    </div>
    <div class="notification-footer">
        <a asp-controller="Admin" asp-action="AllActivity">View all activity</a>
    </div>
</div>