@using ClaimsProcessingSystem.Models.Identity
@model ApplicationUser

@* This first line checks if the user object (Model) exists before trying to use it *@
@if (Model != null)
{
    @if (!string.IsNullOrEmpty(Model.ProfilePicturePath))
    {
        <img src="@Model.ProfilePicturePath" class="rounded-circle" style="width:40px; height:40px; object-fit: cover;" alt="Profile Picture" />
    }
    else
    {
        // This new logic is safer and handles empty or single names correctly.
        var initials = "?";
        if (!string.IsNullOrWhiteSpace(Model.FullName))
        {
            var nameParts = Model.FullName.Split(new[] { ' ' }, StringSplitOptions.RemoveEmptyEntries);
            if (nameParts.Length > 1)
            {
                initials = $"{nameParts[0][0]}{nameParts[nameParts.Length - 1][0]}";
            }
            else if (nameParts.Length == 1 && nameParts[0].Length > 0)
            {
                initials = $"{nameParts[0][0]}";
            }
        }

        <div class="profile-initials" title="@Model.FullName">
            @initials.ToUpper()
        </div>
    }
}